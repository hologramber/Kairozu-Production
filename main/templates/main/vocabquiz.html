{% extends 'kairozu.html' %}
{% block title %}Kairozu {{ chapter.title }} Vocab Quiz{% endblock %}
{% block sidecollapse %}
    {% include 'main/sidecollapse.html' %}
{% endblock %}

{% load static %}
{% block content %}

<div id='wrapper'>
{% include 'main/sidebar.html' %}
    <div class="fc-basic">
        {% include 'main/vocab_base.html' %}
    </div>
    <div class="fc-basic">
        {% if user.profile.currentvocab > chapter.id %}
            <div id="finished-quiz">
                <i class="fa fa-star green-words" aria-hidden="true"></i><span class="grey-words smaller"> You've successfully completed this quiz; words will loop for as long as you'd like to practice.</span>
            </div>
        {% endif %}
        <div id="katakana-tips" style="display: none;">
            <i class="fa fa-star red-words" aria-hidden="true"></i><span class="grey-words smaller"> This vocabulary uses katakana characters (press shift when typing).</span>
        </div>
    </div>
    <div class="s-100"></div>
</div>  <!-- /#wrapper -->

<!-- wanakana, menu toggle, and get/post mechanics -->
<script type='text/javascript' src='{% static 'js/wanakana.js' %}'></script>
<script type='text/javascript' src='{% static 'js/kairozu-util.js' %}'></script>

<script type='text/javascript'>
    var vlevel = 3,
        vocabcode = 'A';
    var $vocabquizform = $('#vocabquizform');
    var input = document.getElementById('id_vocabattempt');
    wanakana.bind(input);

    $vocabquizform.submit(function(event) {
        event.preventDefault();
        var clean_attempt = cleanInput($('#id_vocabattempt').val());
        if (clean_attempt == $('#vactual').val()) {
            $vocabquizform.attr('class', 'abox abox_g');
            $('#bug-button').hide();
            if (vlevel == 3) {
                vocabcode = 'C';
            } else {
                vlevel = 3;
                vocabcode = 'N';
            }
        } else {
            $vocabquizform.attr('class', 'abox_red abox_r');
            $('#bug-button').show();
            if (vlevel == 3) { vocabcode = 'I'; } else { vocabcode = 'A'; }
            if (vlevel > 0) { vlevel--; }
        }
        $('#vcode').val(vocabcode);
        var form_data = $vocabquizform.serialize();
        $.post("{% url 'main:vocabcheck' chapter.id %}", form_data).done(function(data) {
            $vocabquizform[0].reset();
            vocabNext(data, 'vquiz');
        });
    });

    $(document).ready(function() {
        $.get("{% url 'main:vocabgrab' chapter.id %}").done(function (data) {
            vocabNext(data, 'vquiz');
        });
    });

</script>

{% endblock %}
