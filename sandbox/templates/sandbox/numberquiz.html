{% extends 'kairozu.html' %}
{% block title %}Kairozu 番号クイズ{% endblock %}
{% load static %}

{% block content %}

<div class="fc-basic">
    <div id='vocabholder'>
        <div id='vfield'>
            <div id='literal_one' class='vocab-note text-align-center'>&#8203;</div>
            <div id='vocab_english' class='vocab-challenge text-align-center'></div>

                <div class='vocab-promptc text-align-center'>
                    <span id='hint_block' class='ls5r'>&#8203;</span>
                    <a id="bug-button" href="#" tabindex="-1" style="display: none;">
                        <i id="report-issue" class="fa fa-bug red-words" aria-hidden="true"><span class="raleway">&nbsp;Error?</span></i>
                    </a>
                </div>

            <form id='vocabquizform' action='' method='post' class='abox'>{% csrf_token %}
                <input id='id_vocabattempt' type='text' name='vocab_attempt' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' autofocus />
                <input id='vactual' type='hidden' name='vocab_actual' value='' />
                <input id='max_number' type='hidden' name='max_number' value='' />
                <input type='submit' value='&#8680;' />
            </form>
        </div>  <!-- /#vfield -->
    </div>  <!-- /#vocabholder -->

    <div class="s-15"></div>

    <form class="pad-left-15">
        <label class="radio-inline"><input type="radio" name="optradio" value="99" autocomplete="off" checked>&nbsp;1 - 99</label><br />
        <label class="radio-inline"><input type="radio" name="optradio" value="999" autocomplete="off">&nbsp;1 - 999</label><br />
        <label class="radio-inline"><input type="radio" name="optradio" value="9999" autocomplete="off">&nbsp;1 - 9,999</label><br />
        <label class="radio-inline"><input type="radio" name="optradio" value="99999" autocomplete="off">&nbsp;1 - 99,999</label><br />
        <label class="radio-inline"><input type="radio" name="optradio" value="999999" autocomplete="off">&nbsp;1 - 999,999</label>
    </form>
</div>


<div class="s-100"></div>

<!-- wanakana, menu toggle, and get/post mechanics -->
<script type='text/javascript' src='{% static 'js/wanakana.js' %}'></script>
<script type='text/javascript' src='{% static 'js/cookiemonster.js' %}'></script>

<script type='text/javascript'>
    var input = document.getElementById('id_vocabattempt');
    wanakana.bind(input);

    function numberNext(data) {
        if (data != null) {
            data = JSON.parse(data);
            $('#vocab_english').html(data['numd']);
            $('#vactual').val(data['numk']);
            $('#vocabquizform').removeClass('abox_g abox_r');
        }
    }
    $('#vocabquizform').submit(function(event) {
        event.preventDefault();
        var clean_attempt = $('#id_vocabattempt').val().replace(/[　。、？！「」\'\",.?!\s]/g, "");
        $('#vocabquizform #max_number').val($("input[name=optradio]:checked").val());
        var form_data = $('#vocabquizform').serialize();
        if (clean_attempt == $('#vactual').val()) {
            $('#vocabquizform').attr('class', 'abox abox_g');
            $('#bug-button').hide();
            $('#hint_block').html('&#8203;');
            $.post("{% url 'sandbox:numbergrab' %}", form_data).done(function(data) {
                $('#vocabquizform')[0].reset();
                numberNext(data);
            });
        } else {
            $('#vocabquizform').attr('class', 'abox_red abox_r');
            $('#hint_block').html($('#vactual').val());
            $('#vocabquizform')[0].reset();
            $('#bug-button').show();
        }
    });

    $(document).ready(function() {
        $.get("{% url 'sandbox:numbergrab' %}").done(function (data) {
            numberNext(data);
        });
    });

    $('#bug-button').click(function() {
        $('#form-modal-body').load('/news/newissue/', function () {
            modal.style.display = "block";
            formAjaxSubmit('#form-modal-body form', '#form-modal');
        });
    });
</script>

{% endblock %}